{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///Users/carlosruiztorres/btraining-web/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\n\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: ['query'],\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///Users/carlosruiztorres/btraining-web/lib/auth.ts"],"sourcesContent":["import { AuthOptions } from \"next-auth\"\nimport CredentialsProvider from \"next-auth/providers/credentials\"\nimport { PrismaAdapter } from \"@next-auth/prisma-adapter\"\nimport { prisma } from \"@/lib/prisma\"\nimport { compare } from \"bcryptjs\"\n\nexport const authOptions: AuthOptions = {\n  adapter: PrismaAdapter(prisma),\n  providers: [\n    CredentialsProvider({\n      name: 'Credentials',\n      credentials: {\n        email: { label: \"Email\", type: \"text\" },\n        password: { label: \"Password\", type: \"password\" }\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          console.log(\"Missing credentials\")\n          return null\n        }\n        const user = await prisma.user.findUnique({\n          where: {\n            email: credentials.email\n          }\n        })\n\n        if (!user) {\n          console.log(\"User not found:\", credentials.email)\n          return null\n        }\n\n        // Only ADMIN and TRAINER can log in\n        if (user.role === 'CLIENT') {\n          console.log(\"Client login attempt denied:\", credentials.email)\n          return null\n        }\n        \n        // If user has no password (e.g. invited user who hasn't claimed account), deny login\n        if (!user.password) {\n          console.log(\"User has no password set:\", credentials.email)\n          return null\n        }\n        \n        const isPasswordValid = await compare(credentials.password, user.password)\n\n        if (!isPasswordValid) {\n           console.log(\"Invalid password for user:\", credentials.email)\n           return null\n        }\n        return { id: user.id, name: user.name, email: user.email, role: user.role }\n      }\n    })\n  ],\n  session: {\n    strategy: \"jwt\"\n  },\n  pages: {\n    signIn: '/login',\n  },\n  callbacks: {\n      async jwt({ token, user }) {\n        if (user) {\n          token.role = user.role\n        }\n        return token\n      },\n      async session({ session, token }) {\n          if (session.user && token.sub) {\n              // @ts-ignore\n              session.user.id = token.sub;\n              // @ts-ignore\n              session.user.role = token.role;\n          }\n          return session;\n      }\n  },\n  secret: process.env.NEXTAUTH_SECRET,\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;;;;;AAEO,MAAM,cAA2B;IACtC,SAAS,IAAA,qLAAa,EAAC,uHAAM;IAC7B,WAAW;QACT,IAAA,mKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAO;gBACtC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,QAAQ,GAAG,CAAC;oBACZ,OAAO;gBACT;gBACA,MAAM,OAAO,MAAM,uHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBACL,OAAO,YAAY,KAAK;oBAC1B;gBACF;gBAEA,IAAI,CAAC,MAAM;oBACT,QAAQ,GAAG,CAAC,mBAAmB,YAAY,KAAK;oBAChD,OAAO;gBACT;gBAEA,oCAAoC;gBACpC,IAAI,KAAK,IAAI,KAAK,UAAU;oBAC1B,QAAQ,GAAG,CAAC,gCAAgC,YAAY,KAAK;oBAC7D,OAAO;gBACT;gBAEA,qFAAqF;gBACrF,IAAI,CAAC,KAAK,QAAQ,EAAE;oBAClB,QAAQ,GAAG,CAAC,6BAA6B,YAAY,KAAK;oBAC1D,OAAO;gBACT;gBAEA,MAAM,kBAAkB,MAAM,IAAA,4IAAO,EAAC,YAAY,QAAQ,EAAE,KAAK,QAAQ;gBAEzE,IAAI,CAAC,iBAAiB;oBACnB,QAAQ,GAAG,CAAC,8BAA8B,YAAY,KAAK;oBAC3D,OAAO;gBACV;gBACA,OAAO;oBAAE,IAAI,KAAK,EAAE;oBAAE,MAAM,KAAK,IAAI;oBAAE,OAAO,KAAK,KAAK;oBAAE,MAAM,KAAK,IAAI;gBAAC;YAC5E;QACF;KACD;IACD,SAAS;QACP,UAAU;IACZ;IACA,OAAO;QACL,QAAQ;IACV;IACA,WAAW;QACP,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,IAAI,GAAG,KAAK,IAAI;YACxB;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC5B,IAAI,QAAQ,IAAI,IAAI,MAAM,GAAG,EAAE;gBAC3B,aAAa;gBACb,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,GAAG;gBAC3B,aAAa;gBACb,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;YAClC;YACA,OAAO;QACX;IACJ;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;AACrC"}},
    {"offset": {"line": 189, "column": 0}, "map": {"version":3,"sources":["file:///Users/carlosruiztorres/btraining-web/app/page.tsx"],"sourcesContent":["import { getServerSession } from \"next-auth\";\nimport { redirect } from \"next/navigation\";\nimport { authOptions } from \"@/lib/auth\";\n\nexport default async function Home() {\n  const session = await getServerSession(authOptions);\n\n  if (session) {\n    redirect(\"/dashboard\");\n  } else {\n    redirect(\"/login\");\n  }\n\n  return null;\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;;;;AAEe,eAAe;IAC5B,MAAM,UAAU,MAAM,IAAA,yJAAgB,EAAC,0HAAW;IAElD,IAAI,SAAS;QACX,IAAA,iMAAQ,EAAC;IACX,OAAO;QACL,IAAA,iMAAQ,EAAC;IACX;IAEA,OAAO;AACT"}}]
}